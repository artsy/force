/*! jQuery.popLockIt - v0.1.2 - 2013-09-20
* http://zamiang.github.com/jquery.poplockit
* Copyright (c) 2013 Brennan Moore; Licensed MIT */
(function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};(function(e,n,r){var i,s,o,u,a;return a="popLockIt",i=function(){function e(e,t){var n,r,i,s;this.$el=e,this.settings=t,s=this.requires;for(r=0,i=s.length;r<i;r++){n=s[r];if(this.settings[n]==null)throw"You must pass "+n}}return e.prototype.requires=[],e}(),s=function(e){function n(e,t){this.$el=e,this.settings=t,this}return t(n,e),n.prototype.requires=["height","marginTop","marginLeft","marginBottom"],n.prototype.cssProperties=["position","top","bottom","left"],n.prototype.marginTop=0,n.prototype.marginBottom=0,n.prototype.marginLeft=0,n.prototype.parentHeight=0,n.prototype.height=0,n.prototype.top=0,n.prototype.bottom=0,n.prototype.left=0,n.prototype.setMargins=function(e){e.parentHeight&&(this.parentHeight=e.parentHeight),e.marginTop&&(this.marginTop=e.marginTop),e.marginBottom&&(this.marginBottom=e.marginBottom);if(e.marginLeft)return this.marginLeft=e.marginLeft},n.prototype.setDimensions=function(){this.height=Math.floor(Number(this.$el.css("height").replace("px",""))),this.top=Math.floor(this.$el.offset().top-this.marginTop),this.left=Math.floor(this.$el.offset().left),this.bottom=Math.floor(this.top+this.parentHeight-this.height);if(this.top<1)return this.top=1},n.prototype.setPosition=function(e,t){var n,r,i,s,o,u,a;e==null&&(e="absolute"),t==null&&(t="north"),i={position:e,left:Math.round(this.getLeftForPosition(e))},e==="absolute"?(i.top=t==="north"?this.marginTop:"auto",i.bottom=t==="south"?this.marginBottom:"auto"):(i.top=t==="north"?this.marginTop:"auto",i.bottom=t==="south"?0:"auto");if(!this.oldState)return this.$el.css(i),this.oldState=i;r={},n=!1,a=this.cssProperties;for(o=0,u=a.length;o<u;o++)s=a[o],i[s]!==this.oldState[s]&&(r[s]=i[s],n=!0);if(n)return this.$el.css(r),this.oldState=i},n.prototype.getLeftForPosition=function(e){return e==="fixed"?this.left:e==="static"?0:this.left-this.marginLeft},n.prototype.onScroll=function(e,t,n,r){n==null&&(n=!1);if(!n){if(this.height===t)return e<this.top+this.parentHeight-this.height?this.setPosition("fixed","north"):this.setPosition("absolute","south");if(this.height<t)return e>=this.top&&e<this.top+this.parentHeight-this.height?this.setPosition("fixed","north"):this.setPosition("absolute","south");if(this.height>t&&this.height<this.parentHeight&&e+t>=this.top+this.height&&e+t<this.parentHeight+this.top)return this.setPosition("fixed","south")}return e+t>=this.bottom&&this.height>=t?this.setPosition("absolute","south"):this.setPosition("absolute","north")},n.prototype.destroy=function(){return this.setPosition()},n}(i),u=function(n){function r(e,t,n,i){this.$el=e,this.settings=t,this.index=n,this.parent=i,r.__super__.constructor.apply(this,arguments),this.$columns=this.$el.find(this.settings.columnSelector),this.hasColumns()&&(this.setDimensions(),this.createColumns()),this.settings.additionalFeedItemInit&&this.settings.additionalFeedItemInit(this.$el,this.index),this}return t(r,n),r.prototype.requires=["columnSelector"],r.prototype.active=!1,r.prototype.columns=[],r.prototype.createColumns=function(){var t,n,r,i,o,u,a,f;this.columns=this.$columns.map(function(){return new s(e(this))}),u=this.columns;for(n=0,i=u.length;n<i;n++)t=u[n],this.setColumnMargins(t);a=this.columns,f=[];for(r=0,o=a.length;r<o;r++)t=a[r],f.push(t.setDimensions());return f},r.prototype.setDimensions=function(){var e;return this.marginTop=Number(this.$el.css("padding-top").replace("px","")),this.marginBottom=Number(this.$el.css("padding-bottom").replace("px","")),this.resetColumnPositioning(),this.$el.css({height:"auto"}),e=this.$el.css("height"),this.height=Number(e.replace("px","")),this.$el.css({height:e}),this.left=this.$el.offset().left,this.top=this.$el.offset().top,this.bottom=this.top+this.height},r.prototype.onScroll=function(e,t,n){var r,i,s,o,u,a,f,l,c,h,p,d;if(t>=this.height)return this.active=!1;if(e>=this.top&&e<this.bottom){this.active=!0,l=this.columns,p=[];for(i=0,u=l.length;i<u;i++)r=l[i],p.push(r.onScroll(e,t,this.parent.settings.preventFixed));return p}if(this.active){c=this.columns;for(s=0,a=c.length;s<a;s++)r=c[s],r.onScroll(e,t,!0);return this.active=!1}if(n){h=this.columns,d=[];for(o=0,f=h.length;o<f;o++)r=h[o],d.push(r.onScroll(e,t,!0));return d}},r.prototype.recompute=function(){var e,t,n,r,i,s,o,u;this.setDimensions(),s=this.columns;for(t=0,r=s.length;t<r;t++)e=s[t],this.setColumnMargins(e);o=this.columns,u=[];for(n=0,i=o.length;n<i;n++)e=o[n],u.push(e.setDimensions());return u},r.prototype.setColumnMargins=function(e){return e.setMargins({parentHeight:this.height,marginTop:this.marginTop,marginBottom:this.marginBottom,marginLeft:this.left})},r.prototype.recomputeColumn=function(e){if(!this.columns[e])return this.setColumnMargins(this.columns[e]);return},r.prototype.resetColumnPositioning=function(){var e,t,n,r,i;r=this.columns,i=[];for(t=0,n=r.length;t<n;t++)e=r[t],i.push(e.setPosition("static"));return i},r.prototype.destroy=function(){var e,t,n,r,i;r=this.columns,i=[];for(t=0,n=r.length;t<n;t++)e=r[t],i.push(e.destroy());return i},r.prototype.hasColumns=function(){var e;return((e=this.$columns)!=null?e.length:void 0)>1},r}(i),o=function(r){function i(t,r){var s;this.el=t,this.settings=r,this.$el=e(this.el);if(this.settings==null)throw"You must pass settings";if(((s=this.$el)!=null?s.length:void 0)!==1)throw"PopLockIt must be called on one element";i.__super__.constructor.call(this,this.$el,this.settings),this.$window=e(n),this.settings=e.extend(this.defaults,this.settings),this.settings.active=!0,this.initRequestAnimationFrame(),this.viewportHeight=this.$window.outerHeight(!0),this.$el.css({"box-sizing":"border-box",overflow:"hidden"}),this.addFeedItems(this.settings.feedItems),this.requestAnimationFrame(),this}return t(i,r),i.prototype.feedItems=[],i.prototype.requires=["feedItems"],i.prototype.hasFocus=!0,i.prototype.scrollSpeedThreshold=500,i.prototype.defaults={active:!0,rendered:!1,preventFixed:!1},i.prototype.onScroll=function(){var e,t,r,i,s,o=this;if(!this.settings.active)return;t=this.$window.scrollTop();if(t===this.previousScrollTop)return this.requestedAnimationFrame=n.requestAnimationFrame(function(){return o.onScroll()});s=this.feedItems;for(r=0,i=s.length;r<i;r++)e=s[r],e.onScroll(t,this.viewportHeight,Math.abs(t-this.previousScrollTop)>this.scrollSpeedThreshold);return this.previousScrollTop=t,this.settings.onScroll!=null&&this.settings.onScroll(t),this.requestAnimationFrame()},i.prototype.recompute=function(){var e,t,n,r,i,s,o,u,a,f;this.settings.active=!0,u=this.feedItems;for(r=0,s=u.length;r<s;r++)e=u[r],e.recompute();n=this.$window.scrollTop(),a=this.feedItems,f=[];for(i=0,o=a.length;i<o;i++)t=a[i],f.push(t.onScroll(n,this.viewportHeight,!1));return f},i.prototype.recomputeItem=function(e){if(!this.feedItems[e])return;return this.feedItems[e].recompute()},i.prototype.recomputeItemColumn=function(e,t){if(!this.feedItems[e])return;return this.feedItems[e].recomputeColumn(t)},i.prototype.destroy=function(){var t,n,r,i;this.settings.rendered=!1,this.settings.active=!1,e.data(this.$el,"plugin_"+a,!1);if(typeof feedItems!="undefined"&&feedItems!==null?feedItems.length:void 0){i=this.feedItems;for(n=0,r=i.length;n<r;n++)t=i[n],t.destroy()}return this.feedItems=[]},i.prototype.stop=function(){return this.settings.active=!1,n.cancelAnimationFrame(this.requestedAnimationFrame)},i.prototype.start=function(){var e=this;return this.settings.active=!0,n.cancelAnimationFrame(this.requestedAnimationFrame),this.requestedAnimationFrame=n.requestAnimationFrame(function(){return e.onScroll()})},i.prototype.addFeedItems=function(t){var n=this;if(t==null||!t.length)throw"You must pass $feedItems";return t.map(function(t,r){return n.feedItems.push(new u(e(r),n.settings,t,n))})},i.prototype.requestAnimationFrame=function(){var e=this;return this.requestedAnimationFrame=n.requestAnimationFrame(function(){return e.onScroll()})},i.prototype.debounce=function(e,t){var n;return n=0,function(){var r,i,s=this;return r=arguments,i=function(){return n=null,e(r)},clearTimeout(n),n=setTimeout(i,t)}},i.prototype.initRequestAnimationFrame=function(){var e,t,r,i,s;if(n.requestAnimationFrame)return;e=0,r=["ms","moz","webkit","o"];for(i=0,s=r.length;i<s;i++){t=r[i];if(!!n.requestAnimationFrame)continue;n.requestAnimationFrame=n[""+t+"RequestAnimationFrame"],n.cancelAnimationFrame=n["{vendor}CancelAnimationFrame"]||n["{vendors}CancelRequestAnimationFrame"]}n.requestAnimationFrame||(n.requestAnimationFrame=function(t,r){var i,s,o;return i=(new Date).getTime(),o=Math.max(0,16-(i-e)),s=n.setTimeout(function(){return t(i+o)},o),e=i+o,s});if(!n.cancelAnimationFrame)return n.cancelAnimationFrame=function(e){return clearTimeout(e)}},i}(i),e.fn[a]=function(t){if(!e.data(this,"plugin_"+a)){if(t==null)throw"You must pass settings";return e.data(this,"plugin_"+a,new o(this,t))}if(e.data(this,"plugin_"+a)[t]!=null)return e.data(this,"plugin_"+a)[t](Array.prototype.slice.call(arguments,1)[0],Array.prototype.slice.call(arguments,1)[1]);throw"Method '"+t+"' does not exist on jQuery.popLockIt"}})(jQuery,window,document)}).call(this);